{"title":"lodash数组中drop方法","description":"lodash中drop、dropRight、dropRightWhile、dropWhile、slice方法的使用以及分析","keywords":"lodash，drop、dropRight、dropRightWhile、dropWhile、slice，数组，源码分析,每天一个lodash函数","labels":["lodash"],"date":"2021-08-20","path":"2021/08/lodash-array-drop.md","slug":"2021_08_lodash-array-drop","html":"<h2 id=\"drop\">Drop</h2>\n<p>创建一个数组，取出数组前n个元素，n的默认值是1。</p>\n<p>我个人理解为&quot;踢掉&quot;更好。</p>\n<pre><code class=\"language-javascript\"><span class=\"hljs-module-access\"><span class=\"hljs-module\"><span class=\"hljs-identifier\">_</span>.</span></span>drop(<span class=\"hljs-literal\">[<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>]</span>);\n<span class=\"hljs-comment\">// =&gt; [2, 3]</span>\n</code></pre>\n<h3 id=\"源码\">源码</h3>\n<p>drop：</p>\n<pre><code class=\"language-js\">function drop(array, n=1) {\n  // 对数组长度进行判断\n <span class=\"hljs-built_in\"> const </span>length =<span class=\"hljs-built_in\"> array </span>== null ? 0<span class=\"hljs-keyword\"> :</span> array.length\n  // 如果数组有长度的话，走核心的slice方法\n <span class=\"hljs-built_in\"> return </span>length\n    ? slice(array, n &lt; 0 ? 0<span class=\"hljs-keyword\"> :</span> toInteger(n), length)\n   <span class=\"hljs-keyword\"> :</span> []\n}\n</code></pre>\n<p>slice： 虽然slice是后续的内容，但可以提前了解到。</p>\n<pre><code class=\"language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-keyword\">slice</span>(<span class=\"hljs-keyword\">array</span>, <span class=\"hljs-keyword\">start</span>, <span class=\"hljs-keyword\">end</span>) {\n  // 判断数组长度\n  let length = <span class=\"hljs-keyword\">array</span> == <span class=\"hljs-keyword\">null</span> ? <span class=\"hljs-number\">0</span> : <span class=\"hljs-keyword\">array</span>.length\n  <span class=\"hljs-keyword\">if</span> (!length) {\n    <span class=\"hljs-keyword\">return</span> []\n  }\n  start = start == <span class=\"hljs-keyword\">null</span> ? <span class=\"hljs-number\">0</span> : <span class=\"hljs-keyword\">start</span>\n  // 如果没有定义<span class=\"hljs-keyword\">end</span>参数，则默认为数组的长度\n  end = end === undefined ? length : <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">start</span> &lt; <span class=\"hljs-number\">0</span>) {\n    // 还是对输入参数合法的校准，如果开始的数值为负数而且取正后大于\n    // 数组长度，则设置<span class=\"hljs-keyword\">start</span>为<span class=\"hljs-number\">0</span>。\n\n    // 如果不是上述的情况，则会把<span class=\"hljs-keyword\">start</span>设置为length + <span class=\"hljs-keyword\">start</span>\n    // 假如数组 [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>]，<span class=\"hljs-keyword\">slice</span>(arr, <span class=\"hljs-number\">-3</span>, <span class=\"hljs-number\">2</span>)的<span class=\"hljs-keyword\">start</span>为<span class=\"hljs-number\">2</span>\n    start = -<span class=\"hljs-keyword\">start</span> &gt; length ? <span class=\"hljs-number\">0</span> : (length + <span class=\"hljs-keyword\">start</span>)\n  }\n  end = <span class=\"hljs-keyword\">end</span> &gt; length ? length : <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">end</span> &lt; <span class=\"hljs-number\">0</span>) {\n    // 和<span class=\"hljs-keyword\">start</span>处理一致\n    <span class=\"hljs-keyword\">end</span> += length\n  }\n  // 这里处理<span class=\"hljs-keyword\">start</span>和<span class=\"hljs-keyword\">end</span>大小关系\n  // 存在位运算\n  length = <span class=\"hljs-keyword\">start</span> &gt; <span class=\"hljs-keyword\">end</span> ? <span class=\"hljs-number\">0</span> : ((<span class=\"hljs-keyword\">end</span> - <span class=\"hljs-keyword\">start</span>) &gt;&gt;&gt; <span class=\"hljs-number\">0</span>)\n  // start = <span class=\"hljs-keyword\">start</span> &gt;&gt;&gt; <span class=\"hljs-number\">0</span>\n  <span class=\"hljs-keyword\">start</span> &gt;&gt;&gt;= <span class=\"hljs-number\">0</span>\n\n  let <span class=\"hljs-keyword\">index</span> = <span class=\"hljs-number\">-1</span>\n  const result = <span class=\"hljs-built_in\">new</span> <span class=\"hljs-keyword\">Array</span>(length)\n  <span class=\"hljs-keyword\">while</span> (++<span class=\"hljs-keyword\">index</span> &lt; length) {\n    result[<span class=\"hljs-keyword\">index</span>] = <span class=\"hljs-keyword\">array</span>[<span class=\"hljs-keyword\">index</span> + <span class=\"hljs-keyword\">start</span>]\n  }\n  <span class=\"hljs-keyword\">return</span> result\n}\n</code></pre>\n<ul>\n<li>有符号移位&gt;&gt;: 该操作符会将第一个操作数向右移动指定的位数。向右被移出的位被丢弃，拷贝最左侧的位以填充左侧。</li>\n</ul>\n<pre><code><span class=\"hljs-symbol\">9 </span>&gt;&gt; <span class=\"hljs-number\">2</span>\n<span class=\"hljs-symbol\">11111111111111111111111111110111 </span> // -<span class=\"hljs-number\">9</span> -&gt; <span class=\"hljs-number\">11111111111111111111111111111101</span>   // -<span class=\"hljs-number\">3</span>\n</code></pre>\n<ul>\n<li>无符号移位&gt;&gt;&gt;: 该操作符会将第一个操作数向右移动指定的位数。向右被移出的位被丢弃，左侧用0填充。因为符号位变成了 0，所以结果总是非负的。</li>\n</ul>\n<pre><code><span class=\"hljs-symbol\">9 </span>&gt;&gt;&gt; <span class=\"hljs-number\">2</span>\n<span class=\"hljs-symbol\">00000000000000000000000000001001 </span>  // <span class=\"hljs-number\">9</span> -&gt;  <span class=\"hljs-number\">00000000000000000000000000000010</span> // <span class=\"hljs-number\">2</span>\n</code></pre>\n<h3 id=\"扩展\">扩展</h3>\n<h4 id=\"droprightarray-n1\">dropRight(array, [n=1])</h4>\n<p>从尾部倒过来切。</p>\n<h4 id=\"droprightwhilearray-predicate_identity\">dropRightWhile(array, [predicate=_.identity])</h4>\n<p>创建一个切片数组，去除array中从 predicate 返回假值开始到尾部的部分。</p>\n<p>xxxxx(xxxxxxxxxxxxx)\n      ^            ^\n      |            |\n predicate假       结尾</p>\n<pre><code class=\"language-js\">var users = [\n  { <span class=\"hljs-string\">&#x27;user&#x27;</span>: <span class=\"hljs-string\">&#x27;barney&#x27;</span>,  <span class=\"hljs-string\">&#x27;active&#x27;</span>: <span class=\"hljs-keyword\">true</span> },\n  { <span class=\"hljs-string\">&#x27;user&#x27;</span>: <span class=\"hljs-string\">&#x27;fred&#x27;</span>,    <span class=\"hljs-string\">&#x27;active&#x27;</span>: <span class=\"hljs-keyword\">false</span> },\n  { <span class=\"hljs-string\">&#x27;user&#x27;</span>: <span class=\"hljs-string\">&#x27;pebbles&#x27;</span>, <span class=\"hljs-string\">&#x27;active&#x27;</span>: <span class=\"hljs-keyword\">false</span> }\n];\n \n <span class=\"hljs-regexp\">//</span> 切掉users中active为<span class=\"hljs-keyword\">false</span>的对象\n\n_.dropRightWhile(users, function(o) { <span class=\"hljs-keyword\">return</span> !o.active; });\n<span class=\"hljs-regexp\">//</span> =&gt; objects <span class=\"hljs-keyword\">for</span> [<span class=\"hljs-string\">&#x27;barney&#x27;</span>]\n\n_.dropRightWhile(users, { <span class=\"hljs-string\">&#x27;user&#x27;</span>: <span class=\"hljs-string\">&#x27;pebbles&#x27;</span>, <span class=\"hljs-string\">&#x27;active&#x27;</span>: <span class=\"hljs-keyword\">false</span> });\n<span class=\"hljs-regexp\">//</span> =&gt; objects <span class=\"hljs-keyword\">for</span> [<span class=\"hljs-string\">&#x27;barney&#x27;</span>, <span class=\"hljs-string\">&#x27;fred&#x27;</span>]\n</code></pre>\n<p>这貌似和filter的感觉一样，但drop返回的是一个新数组且predicate更具有灵活性。</p>\n<h4 id=\"dropwhilearray-predicate_identity\">dropWhile(array, [predicate=_.identity])</h4>\n<p>创建一个切片数组，去除array中从起点开始到 predicate 返回假值结束部分。</p>\n<p>(xxxxxxxxxxx)xxxxxxx\n           ^\n           |\n       predicate假</p>\n<p>identity为返回入参自身。</p>\n<pre><code>dentity = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(value)</span> </span>{ <span class=\"hljs-keyword\">return</span> value; }\n</code></pre>\n<p>predicate传入对象也会在内部变为函数处理，编译后的代码为：</p>\n<pre><code class=\"language-js\"><span class=\"hljs-keyword\">function</span> drop<span class=\"hljs-constructor\">While(<span class=\"hljs-params\">array</span>, <span class=\"hljs-params\">predicate</span>)</span> {\n  return (<span class=\"hljs-built_in\">array</span><span class=\"hljs-operator\"> &amp;&amp; </span><span class=\"hljs-built_in\">array</span>.length)\n    ? base<span class=\"hljs-constructor\">While(<span class=\"hljs-params\">array</span>, <span class=\"hljs-params\">getIteratee</span>(<span class=\"hljs-params\">predicate</span>, 3)</span>, <span class=\"hljs-literal\">true</span>)\n    : <span class=\"hljs-literal\">[]</span>;\n}\n</code></pre>\n"}