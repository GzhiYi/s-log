<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Mrn4dXO3Z_939geeswIgr2wIpspT6n7X5cX1Tjp69Ko name=google-site-verification> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=atom-one-light.min.css rel=stylesheet> <link href=client/client-87ec37cb.css rel=stylesheet><link href=client/[slug]-2cfb82a0.css rel=stylesheet> <title>微信小程序获取群id的方式-GzhiYi's blog</title><meta content=小程序怎么获取群的唯一标识，获取群id，opengid，怎么解密。这里有两种方式解密，一种是服务端，一种是云函数端。 name=description data-svelte=svelte-2vncnt><meta content=小程序，群id，opengid，解密，getGroupEnterInfo，CloudID解密，云函数获取群opengid，云函数解密群opengid name=keywords data-svelte=svelte-2vncnt> <link href=/client/client.e0961b94.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-87ec37cb.css rel=preload as=style><link href=/client/[slug].13458e28.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/config.026ad977.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/[slug]-2cfb82a0.css rel=preload as=style></head> <body> <div id=sapper> <nav class=svelte-1vrbr95><ul class=svelte-1vrbr95><li class=svelte-1vrbr95><a href=blog aria-current=page class=svelte-1vrbr95 rel=prefetch>文章列表</a></ul></nav> <div style=width:100%;height:56px;background-color:#dee2e8></div> <main class=svelte-1ca6gui style=padding:1rem> <div class="svelte-vusc9 base"><div class="svelte-vusc9 title">微信小程序获取群id的方式</div> <span class="svelte-vusc9 author">GzhiYi · 2021-09-07</span> <div class=label>小程序</div></div> <div class="svelte-vusc9 content"><p><div style=text-align:center><img align=center alt="图 1" data-zoomable src=https://i.loli.net/2021/09/07/MWD9UtfXIVFZzPj.png style=width:-webkit-fill-available;margin-bottom:20px;border-radius:8px;background:#f8fdf3></div><p></p> <p>如果小程序中有应用场景涉及到需要获取群的唯一标识的，可以获取opengid用以区分。</p> <p><code>wx.getGroupEnterInfo()</code>可以获取到opengid。</p> <h3 id=回调内容>回调内容</h3> <pre><code>wx.getGroupEnterInfo({
  success(res) {
    <span class=hljs-regexp>//</span> errMsg 错误信息    
    <span class=hljs-regexp>//</span> encryptedData 加密数据
    <span class=hljs-regexp>//</span> iv 加密算法的初始向量
    <span class=hljs-regexp>//</span> cloudID 敏感数据对应的云 ID，开通云开发的小程序才会返回，可通过云调用直接获取开放数据
  }
})
</code></pre> <p>如果解密成功，将会获取opengid。</p> <h3 id=服务端解密encrypteddata获取opengid>服务端解密encryptedData获取opengid</h3> <p>此处以<code>nodejs</code>为例子，需要准备的内容参数：</p> <ol> <li>appId。小程序的appId。</li> <li>session_key。小程序会话key，获取方式： <div style=text-align:center><img align=center alt=session_key获取 data-zoomable src=https://i.loli.net/2021/09/07/cmuFGA7rZHLJzh1.png style=width:-webkit-fill-available;margin-bottom:20px;border-radius:8px;background:#f8fdf3></div> </li> <li>encryptedData。上面提到的加密数据。</li> <li>iv。加密算法的初始向量。</li> </ol> <pre><code class=language-js><span class=hljs-regexp>//</span> 引入 WXBizDataCrypt
<span class=hljs-regexp>//</span>  WXBizDataCrypt下载地址：https:<span class=hljs-regexp>//</span>res.wx.qq.com<span class=hljs-regexp>/wxdoc/</span>dist<span class=hljs-regexp>/assets/m</span>edia/aes-sample.eae1f364.zip，在里面找到。
const WXBizDataCrypt = require(<span class=hljs-string>'./WXBizDataCrypt'</span>)

const appId = <span class=hljs-string>''</span>
const sessionKey = <span class=hljs-string>''</span>
const encryptedData = <span class=hljs-string>''</span>
const iv = <span class=hljs-string>''</span>

const pc = new WXBizDataCrypt(appId, sessionKey)

<span class=hljs-regexp>//</span> 解密后的数据
const data = pc.decryptData(encryptedData , iv)
</code></pre> <h3 id=云函数解密opengid>云函数解密opengid</h3> <p>需要准备一个接受调用解密的云函数。</p> <p>在小程序端调用：</p> <pre><code class=language-js>const cloudID = <span class=hljs-string>''</span> <span class=hljs-comment>// 这里是调用getGroupEnterInfo返回的cloudID</span>
wx<span class=hljs-selector-class>.cloud</span><span class=hljs-selector-class>.callFunction</span>({
  name: <span class=hljs-string>'decrypt'</span>,
  data: {
    groupData: wx<span class=hljs-selector-class>.cloud</span><span class=hljs-selector-class>.CloudID</span>(cloudID), <span class=hljs-comment>// 这个 CloudID 值到云函数端会被替换</span>
    <span class=hljs-comment>// 下面这个obj是错误示例，不会在云函数中把解密的opengid塞进obj，所以遵循上面的写法，只放在第一层</span>
    obj: {
      groupData: wx<span class=hljs-selector-class>.cloud</span><span class=hljs-selector-class>.CloudID</span>(cloudID), <span class=hljs-comment>// 不要这么写！！</span>
    }
  }
})
</code></pre> <p>在云函数端，应该是这样的：</p> <pre><code class=language-js>exports.main = <span class=hljs-keyword>async</span> (<span class=hljs-keyword>event</span>) => {
  <span class=hljs-comment>// groupData是和小程序端的命名是一致的，这样才能正确返回</span>
  <span class=hljs-keyword>return</span> {
    code: <span class=hljs-number>1</span>,
    data: <span class=hljs-keyword>event</span>.groupInfo.data,
    msg: <span class=hljs-string>'获取成功'</span>,
  }
}
</code></pre> <h3 id=只显示群昵称>只显示群昵称</h3> <p>小程序可以通过开发数据组件open-data展示群昵称，需要的参数为opengid。</p> <pre><code class=language-html><span class=xml><span class=hljs-tag>&lt;<span class=hljs-name>open-data</span> <span class=hljs-attr>type</span>=<span class=hljs-string>"groupName"</span> <span class=hljs-attr>open-gid</span>=<span class=hljs-string>"</span></span></span><span class=hljs-template-variable>{{<span class=hljs-name>opengid</span>}}</span><span class=xml><span class=hljs-tag><span class=hljs-string>"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>open-data</span>></span></span>
</code></pre> <p>如果想修改样式，需要在外面包一层view进行样式控制。</p> <p>不能通过一个固定的opengid获取群名，这在模拟器中调试是不成功的。</p> </div> <div class="svelte-vusc9 contact"><div style=line-height:20px>如果你对这页内容有疑问，欢迎联系我！</div> <a href="mailto:zhiyi.gong@outlook.com?subject=【重要】微信小程序获取群id的方式&body=gzhiyi.top/blog/2021_09_mp_get_opengid" target=_blank>邮箱 </a> <br> <a href=https://github.com/gzhiyi target=_blank>github </a> </div> </main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"微信小程序获取群id的方式",description:"小程序怎么获取群的唯一标识，获取群id，opengid，怎么解密。这里有两种方式解密，一种是服务端，一种是云函数端。",keywords:"小程序，群id，opengid，解密，getGroupEnterInfo，CloudID解密，云函数获取群opengid，云函数解密群opengid",labels:["小程序"],date:"2021-09-07",path:"2021\u002F09\u002Fmp_get_opengid.md",slug:"2021_09_mp_get_opengid",html:"\u003Cp\u003E\u003Cdiv style=\"text-align: center;\"\u003E\u003Cimg align=\"center\" style=\"width: -webkit-fill-available;margin-bottom: 20px;border-radius: 8px;background: #f8fdf3;\" data-zoomable src=\"https:\u002F\u002Fi.loli.net\u002F2021\u002F09\u002F07\u002FMWD9UtfXIVFZzPj.png\" alt=\"图 1\" \u003E\u003C\u002Fdiv\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E如果小程序中有应用场景涉及到需要获取群的唯一标识的，可以获取opengid用以区分。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode\u003Ewx.getGroupEnterInfo()\u003C\u002Fcode\u003E可以获取到opengid。\u003C\u002Fp\u003E\n\u003Ch3 id=\"回调内容\"\u003E回调内容\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Ccode\u003Ewx.getGroupEnterInfo({\n  success(res) {\n    \u003Cspan class=\"hljs-regexp\"\u003E\u002F\u002F\u003C\u002Fspan\u003E errMsg 错误信息    \n    \u003Cspan class=\"hljs-regexp\"\u003E\u002F\u002F\u003C\u002Fspan\u003E encryptedData 加密数据\n    \u003Cspan class=\"hljs-regexp\"\u003E\u002F\u002F\u003C\u002Fspan\u003E iv 加密算法的初始向量\n    \u003Cspan class=\"hljs-regexp\"\u003E\u002F\u002F\u003C\u002Fspan\u003E cloudID 敏感数据对应的云 ID，开通云开发的小程序才会返回，可通过云调用直接获取开放数据\n  }\n})\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E如果解密成功，将会获取opengid。\u003C\u002Fp\u003E\n\u003Ch3 id=\"服务端解密encrypteddata获取opengid\"\u003E服务端解密encryptedData获取opengid\u003C\u002Fh3\u003E\n\u003Cp\u003E此处以\u003Ccode\u003Enodejs\u003C\u002Fcode\u003E为例子，需要准备的内容参数：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003EappId。小程序的appId。\u003C\u002Fli\u003E\n\u003Cli\u003Esession_key。小程序会话key，获取方式：\n\u003Cdiv style=\"text-align: center;\"\u003E\u003Cimg align=\"center\" style=\"width: -webkit-fill-available;margin-bottom: 20px;border-radius: 8px;background: #f8fdf3;\" data-zoomable src=\"https:\u002F\u002Fi.loli.net\u002F2021\u002F09\u002F07\u002FcmuFGA7rZHLJzh1.png\" alt=\"session_key获取\" \u003E\u003C\u002Fdiv\u003E \u003C\u002Fli\u003E\n\u003Cli\u003EencryptedData。上面提到的加密数据。\u003C\u002Fli\u003E\n\u003Cli\u003Eiv。加密算法的初始向量。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"hljs-regexp\"\u003E\u002F\u002F\u003C\u002Fspan\u003E 引入 WXBizDataCrypt\n\u003Cspan class=\"hljs-regexp\"\u003E\u002F\u002F\u003C\u002Fspan\u003E  WXBizDataCrypt下载地址：https:\u003Cspan class=\"hljs-regexp\"\u003E\u002F\u002F\u003C\u002Fspan\u003Eres.wx.qq.com\u003Cspan class=\"hljs-regexp\"\u003E\u002Fwxdoc\u002F\u003C\u002Fspan\u003Edist\u003Cspan class=\"hljs-regexp\"\u003E\u002Fassets\u002Fm\u003C\u002Fspan\u003Eedia\u002Faes-sample.eae1f364.zip，在里面找到。\nconst WXBizDataCrypt = require(\u003Cspan class=\"hljs-string\"\u003E&#x27;.\u002FWXBizDataCrypt&#x27;\u003C\u002Fspan\u003E)\n\nconst appId = \u003Cspan class=\"hljs-string\"\u003E&#x27;&#x27;\u003C\u002Fspan\u003E\nconst sessionKey = \u003Cspan class=\"hljs-string\"\u003E&#x27;&#x27;\u003C\u002Fspan\u003E\nconst encryptedData = \u003Cspan class=\"hljs-string\"\u003E&#x27;&#x27;\u003C\u002Fspan\u003E\nconst iv = \u003Cspan class=\"hljs-string\"\u003E&#x27;&#x27;\u003C\u002Fspan\u003E\n\nconst pc = new WXBizDataCrypt(appId, sessionKey)\n\n\u003Cspan class=\"hljs-regexp\"\u003E\u002F\u002F\u003C\u002Fspan\u003E 解密后的数据\nconst data = pc.decryptData(encryptedData , iv)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 id=\"云函数解密opengid\"\u003E云函数解密opengid\u003C\u002Fh3\u003E\n\u003Cp\u003E需要准备一个接受调用解密的云函数。\u003C\u002Fp\u003E\n\u003Cp\u003E在小程序端调用：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003Econst cloudID = \u003Cspan class=\"hljs-string\"\u003E&#x27;&#x27;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 这里是调用getGroupEnterInfo返回的cloudID\u003C\u002Fspan\u003E\nwx\u003Cspan class=\"hljs-selector-class\"\u003E.cloud\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-selector-class\"\u003E.callFunction\u003C\u002Fspan\u003E({\n  name: \u003Cspan class=\"hljs-string\"\u003E&#x27;decrypt&#x27;\u003C\u002Fspan\u003E,\n  data: {\n    groupData: wx\u003Cspan class=\"hljs-selector-class\"\u003E.cloud\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-selector-class\"\u003E.CloudID\u003C\u002Fspan\u003E(cloudID), \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 这个 CloudID 值到云函数端会被替换\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 下面这个obj是错误示例，不会在云函数中把解密的opengid塞进obj，所以遵循上面的写法，只放在第一层\u003C\u002Fspan\u003E\n    obj: {\n      groupData: wx\u003Cspan class=\"hljs-selector-class\"\u003E.cloud\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-selector-class\"\u003E.CloudID\u003C\u002Fspan\u003E(cloudID), \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 不要这么写！！\u003C\u002Fspan\u003E\n    }\n  }\n})\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E在云函数端，应该是这样的：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-js\"\u003Eexports.main = \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003Eevent\u003C\u002Fspan\u003E) =&gt; {\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F groupData是和小程序端的命名是一致的，这样才能正确返回\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E {\n    code: \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E,\n    data: \u003Cspan class=\"hljs-keyword\"\u003Eevent\u003C\u002Fspan\u003E.groupInfo.data,\n    msg: \u003Cspan class=\"hljs-string\"\u003E&#x27;获取成功&#x27;\u003C\u002Fspan\u003E,\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 id=\"只显示群昵称\"\u003E只显示群昵称\u003C\u002Fh3\u003E\n\u003Cp\u003E小程序可以通过开发数据组件open-data展示群昵称，需要的参数为opengid。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-html\"\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eopen-data\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Etype\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E&quot;groupName&quot;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eopen-gid\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E&quot;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{{\u003Cspan class=\"hljs-name\"\u003Eopengid\u003C\u002Fspan\u003E}}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E\u003Cspan class=\"hljs-string\"\u003E&quot;\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eopen-data\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E如果想修改样式，需要在外面包一层view进行样式控制。\u003C\u002Fp\u003E\n\u003Cp\u003E不能通过一个固定的opengid获取群名，这在模拟器中调试是不成功的。\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.e0961b94.js"}catch(e){main="/client/legacy/client.c8e72cd1.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170295070-1"></script> <script> window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-170295070-1'); </script> 